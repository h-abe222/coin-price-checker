# ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

## ğŸ—ï¸ å…¨ä½“æ§‹æˆ

ã‚³ã‚¤ãƒ³ä¾¡æ ¼ãƒã‚§ãƒƒã‚«ãƒ¼ã¯ã€**2ã¤ã®ç‹¬ç«‹ã—ãŸã‚·ã‚¹ãƒ†ãƒ **ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                ã‚³ã‚¤ãƒ³ä¾¡æ ¼ãƒã‚§ãƒƒã‚«ãƒ¼                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ        â”‚    â”‚     CLIä¾¡æ ¼æ¯”è¼ƒã‚·ã‚¹ãƒ†ãƒ       â”‚  â”‚
â”‚  â”‚  (Web UI + DB)     â”‚    â”‚   (Multi-Site Scraper)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ æ¯”è¼ƒ

| ç‰¹å¾´ | æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ  | CLIä¾¡æ ¼æ¯”è¼ƒã‚·ã‚¹ãƒ†ãƒ  |
|------|-------------|-------------------|
| **å¯¾å¿œã‚µã‚¤ãƒˆ** | 1ã‚µã‚¤ãƒˆ/å•†å“ | è¤‡æ•°ã‚µã‚¤ãƒˆ/å•†å“ |
| **å®Ÿè¡Œæ–¹æ³•** | Web UI | ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ |
| **ä¾¡æ ¼æ¯”è¼ƒ** | âŒ ãªã— | âœ… ã‚ã‚Šï¼ˆæœ€å®‰å€¤ç™ºè¦‹ï¼‰ |
| **ãƒ‡ãƒ¼ã‚¿ä¿å­˜** | å€‹åˆ¥ã‚¨ãƒ³ãƒˆãƒªãƒ¼ | æ¯”è¼ƒçµæœå«ã‚€ |
| **è‡ªå‹•åŒ–** | âœ… Webç®¡ç† | âœ… CLI + GitHub Actions |
| **ãƒ¦ãƒ¼ã‚¶ãƒ¼** | ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ | é–‹ç™ºè€…ãƒ»ãƒ‘ãƒ¯ãƒ¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ |

## ğŸŒ æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ï¼ˆWeb UI + Databaseï¼‰

### æ§‹æˆè¦ç´ 
```
Web UI (index.html)
    â†“ APIå‘¼ã³å‡ºã—
Cloudflare Workers (worker.js)
    â†“ ãƒ‡ãƒ¼ã‚¿æ“ä½œ
D1 Database (SQLite)
    â†“ ä¾¡æ ¼å–å¾—
Single-Site Scraper (price-checker.js)
```

### ç‰¹å¾´
- **1å•†å“ = 1ã‚µã‚¤ãƒˆ**ã®åˆ¶é™
- Webç®¡ç†ç”»é¢ã§ã®ç›´æ„Ÿçš„æ“ä½œ
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ä¾¡æ ¼è¡¨ç¤º
- å•†å“è¿½åŠ ãƒ»å‰Šé™¤ãƒ»æœ‰åŠ¹åŒ–

### ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
```sql
products (
  id, key, url, name, site,
  current_price, image_url,
  enabled, created_at, updated_at
)
```

## ğŸš€ CLIä¾¡æ ¼æ¯”è¼ƒã‚·ã‚¹ãƒ†ãƒ 

### æ§‹æˆè¦ç´ 
```
Product Mappings (PRODUCT_MAPPINGS)
    â†“ å•†å“å®šç¾©
ScraperFactory
    â†“ ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼ç®¡ç†
Multi-Site Scrapers (BullionStar, LPM)
    â†“ ä¾¡æ ¼å–å¾—
Price Comparison Engine
    â†“ æ¯”è¼ƒåˆ†æ
Database Integration
```

### ç‰¹å¾´
- **1å•†å“ = è¤‡æ•°ã‚µã‚¤ãƒˆ**å¯¾å¿œ
- ä¾¡æ ¼æ¯”è¼ƒãƒ»æœ€å®‰å€¤ç™ºè¦‹
- æ•°é‡å‰²å¼•ä¾¡æ ¼å¯¾å¿œ
- ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆè‡ªå‹•å¤‰æ›

### ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼
```javascript
PRODUCT_MAPPINGS
  â†“ å•†å“ã‚­ãƒ¼æŒ‡å®š
ScraperFactory.scrapeMultipleSites()
  â†“ å„ã‚µã‚¤ãƒˆã‹ã‚‰ä¾¡æ ¼å–å¾—
Price Comparison Report
  â†“ æ¯”è¼ƒçµæœ
Database Save (å€‹åˆ¥ã‚¨ãƒ³ãƒˆãƒªãƒ¼)
```

## ğŸ”§ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯è©³ç´°

### å…±é€šåŸºç›¤
```yaml
Runtime: Node.js 18+
Browser: Playwright (Chromium)
Database: Cloudflare D1 (SQLite)
Deployment: Cloudflare Workers
Repository: GitHub
```

### æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ 
```yaml
Frontend: HTML5 + Tailwind CSS + Vanilla JS
API: Cloudflare Workers (RESTful)
Scraping: Single-site focused
Management: Web-based CRUD
```

### CLIä¾¡æ ¼æ¯”è¼ƒã‚·ã‚¹ãƒ†ãƒ 
```yaml
Architecture: Plugin-based scrapers
Execution: Command-line interface
Comparison: Multi-site analysis
Automation: npm scripts + GitHub Actions
```

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆãƒãƒƒãƒ”ãƒ³ã‚°

```
coin-price-checker/
â”œâ”€â”€ ğŸŒ æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ 
â”‚   â”œâ”€â”€ index.html                     # Web UI
â”‚   â””â”€â”€ cloudflare/
â”‚       â”œâ”€â”€ worker.js                  # API + Webé…ä¿¡
â”‚       â”œâ”€â”€ price-checker.js           # å˜ä¸€ã‚µã‚¤ãƒˆã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼
â”‚       â”œâ”€â”€ wrangler.toml             # Cloudflareè¨­å®š
â”‚       â””â”€â”€ schema.sql                # DBå®šç¾©
â”‚
â”œâ”€â”€ ğŸš€ CLIä¾¡æ ¼æ¯”è¼ƒã‚·ã‚¹ãƒ†ãƒ 
â”‚   â””â”€â”€ cloudflare/
â”‚       â”œâ”€â”€ multi-site-price-checker.js   # ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œ
â”‚       â””â”€â”€ scrapers/
â”‚           â”œâ”€â”€ base_scraper.js           # åŸºåº•ã‚¯ãƒ©ã‚¹
â”‚           â”œâ”€â”€ scraper_factory.js        # ç®¡ç†ãƒ»æ¯”è¼ƒã‚¨ãƒ³ã‚¸ãƒ³
â”‚           â”œâ”€â”€ bullionstar_scraper.js    # BullionStarå°‚ç”¨
â”‚           â””â”€â”€ lpm_scraper.js            # LPMå°‚ç”¨
â”‚
â””â”€â”€ ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ãã®ä»–
    â”œâ”€â”€ docs/                         # å„ç¨®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
    â”œâ”€â”€ archived/                     # ãƒ¬ã‚¬ã‚·ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«
    â”œâ”€â”€ python-versions/              # Pythonç‰ˆ
    â””â”€â”€ web-interfaces/               # ä»£æ›¿UI
```

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼æ¯”è¼ƒ

### æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼
```
1. Web UI â†’ å•†å“URLå…¥åŠ›
2. Worker API â†’ products ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜
3. price-checker.js â†’ å˜ä¸€ã‚µã‚¤ãƒˆã‹ã‚‰ä¾¡æ ¼å–å¾—
4. Worker API â†’ ä¾¡æ ¼æ›´æ–°
5. Web UI â†’ æ›´æ–°ã•ã‚ŒãŸä¾¡æ ¼è¡¨ç¤º
```

### CLIä¾¡æ ¼æ¯”è¼ƒã‚·ã‚¹ãƒ†ãƒ ã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼
```
1. PRODUCT_MAPPINGS â†’ è¤‡æ•°ã‚µã‚¤ãƒˆå•†å“å®šç¾©
2. multi-site-price-checker.js â†’ å®Ÿè¡Œé–‹å§‹
3. ScraperFactory â†’ å„ã‚µã‚¤ãƒˆã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼èµ·å‹•
4. å„Scraper â†’ ã‚µã‚¤ãƒˆåˆ¥ä¾¡æ ¼å–å¾—
5. Comparison Engine â†’ ä¾¡æ ¼æ¯”è¼ƒåˆ†æ
6. Database Integration â†’ æ¯”è¼ƒçµæœä¿å­˜
7. Console Output â†’ çµæœè¡¨ç¤º
```

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### æ—¢å­˜ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãã®ã¾ã¾åˆ©ç”¨ï¼‰
```sql
-- å•†å“ãƒã‚¹ã‚¿ãƒ¼
CREATE TABLE products (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    key TEXT UNIQUE NOT NULL,           -- å•†å“ã‚­ãƒ¼
    url TEXT NOT NULL,                  -- å•†å“URL
    name TEXT,                          -- å•†å“å
    site TEXT,                          -- ã‚µã‚¤ãƒˆå
    current_price INTEGER DEFAULT 0,    -- ç¾åœ¨ä¾¡æ ¼
    image_url TEXT,                     -- å•†å“ç”»åƒURL
    enabled INTEGER DEFAULT 1,          -- æœ‰åŠ¹ãƒ•ãƒ©ã‚°
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- ä¾¡æ ¼å±¥æ­´
CREATE TABLE price_history (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    product_id INTEGER,                 -- products.id
    price INTEGER NOT NULL,             -- ä¾¡æ ¼
    currency TEXT DEFAULT 'JPY',       -- é€šè²¨
    recorded_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (product_id) REFERENCES products(id)
);
```

### CLIä¾¡æ ¼æ¯”è¼ƒã§ã®åˆ©ç”¨æ–¹æ³•
```javascript
// å„ã‚µã‚¤ãƒˆã®çµæœã‚’å€‹åˆ¥ã‚¨ãƒ³ãƒˆãƒªãƒ¼ã¨ã—ã¦ä¿å­˜
updates = [
  {
    key: 'bullionstar-com-canadian-silver-maple-1oz',
    price: 5835,
    name: 'Canadian Silver Maple Leaf 1oz (bullionstar.com)',
    site: 'bullionstar.com',
    imageUrl: '...',
    comparisonData: {
      rank: 1,
      totalSites: 2,
      priceSpread: 4
    }
  },
  {
    key: 'lpm-hk-canadian-silver-maple-1oz',
    price: 6100,
    name: 'Canadian Silver Maple Leaf 1oz (lpm.hk)',
    site: 'lpm.hk',
    imageUrl: '...',
    comparisonData: {
      rank: 2,
      totalSites: 2,
      priceSpread: 4,
      bulkPrices: { bulk_5: 6050, bulk_100: 5950 }
    }
  }
]
```

## ğŸ”Œ APIçµ±åˆãƒã‚¤ãƒ³ãƒˆ

### æ—¢å­˜Worker APIåˆ©ç”¨
CLIä¾¡æ ¼æ¯”è¼ƒã‚·ã‚¹ãƒ†ãƒ ã¯æ—¢å­˜ã®Worker APIã‚’æ´»ç”¨ï¼š

```javascript
// ä¾¡æ ¼æ›´æ–°APIåˆ©ç”¨
const response = await fetch(`${WORKER_URL}/api/update-prices`, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${ADMIN_PASSWORD}`
  },
  body: JSON.stringify({ updates })
});
```

### Web UIã§ã®ç¢ºèª
CLIä¾¡æ ¼æ¯”è¼ƒã®çµæœã¯æ—¢å­˜Web UIã§ç¢ºèªå¯èƒ½ï¼š
- https://coin-price-checker.h-abe.workers.dev/admin
- å„ã‚µã‚¤ãƒˆã®ä¾¡æ ¼ãŒå€‹åˆ¥å•†å“ã¨ã—ã¦è¡¨ç¤º

## ğŸ”§ æ‹¡å¼µæ€§ãƒ»å°†æ¥è¨­è¨ˆ

### æ–°ã‚µã‚¤ãƒˆè¿½åŠ ã®å®¹æ˜“æ€§
```javascript
// æ–°ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼è¿½åŠ 
class NewSiteScraper extends BaseScraper {
  // ã‚µã‚¤ãƒˆå›ºæœ‰ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
}

// ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ã«ç™»éŒ²
scrapers.set('newsite.com', new NewSiteScraper(browser));

// å•†å“ãƒãƒƒãƒ”ãƒ³ã‚°æ›´æ–°
PRODUCT_MAPPINGS['product-key'].push({
  site: 'newsite.com',
  url: '...',
  name: '...'
});
```

### ã‚·ã‚¹ãƒ†ãƒ çµ±åˆã®å¯èƒ½æ€§
å°†æ¥çš„ã«ã¯ä»¥ä¸‹ã®çµ±åˆãŒå¯èƒ½ï¼š

1. **Web UIã§ã®ä¾¡æ ¼æ¯”è¼ƒè¡¨ç¤º**
   - è¤‡æ•°ã‚µã‚¤ãƒˆä¾¡æ ¼ã‚’ä¸€è¦§è¡¨ç¤º
   - æœ€å®‰å€¤ãƒã‚¤ãƒ©ã‚¤ãƒˆ

2. **è‡ªå‹•ä¾¡æ ¼ã‚¢ãƒ©ãƒ¼ãƒˆ**
   - ä¾¡æ ¼å·®ãŒä¸€å®šå€¤ä»¥ä¸Šã§é€šçŸ¥
   - æœ€å®‰å€¤ã‚µã‚¤ãƒˆå¤‰æ›´æ™‚ã®é€šçŸ¥

3. **çµ±åˆç®¡ç†ç”»é¢**
   - å•†å“ãƒãƒƒãƒ”ãƒ³ã‚°ç®¡ç†UI
   - ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç‰¹æ€§

### æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ 
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“**: ~100ms (Worker)
- **ä¾¡æ ¼å–å¾—**: ~10ç§’/å•†å“
- **åŒæ™‚ãƒ¦ãƒ¼ã‚¶ãƒ¼**: è¤‡æ•°å¯¾å¿œ
- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§**: é«˜

### CLIä¾¡æ ¼æ¯”è¼ƒã‚·ã‚¹ãƒ†ãƒ 
- **å®Ÿè¡Œæ™‚é–“**: 1-2åˆ†ï¼ˆå…¨å•†å“ï¼‰
- **ä¾¡æ ¼å–å¾—**: ~30ç§’/å•†å“ï¼ˆè¤‡æ•°ã‚µã‚¤ãƒˆï¼‰
- **åŒæ™‚å®Ÿè¡Œ**: 1ãƒ—ãƒ­ã‚»ã‚¹
- **ãƒãƒƒãƒå‡¦ç†**: æœ€é©

## ğŸ”„ é‹ç”¨ã‚·ãƒŠãƒªã‚ª

### æ—¥å¸¸é‹ç”¨ã§ã®ä½¿ã„åˆ†ã‘

#### Web UIï¼ˆæ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ï¼‰
- **åˆ©ç”¨ã‚·ãƒ¼ãƒ³**: æ—¥å¸¸çš„ãªä¾¡æ ¼ç¢ºèª
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼**: ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼
- **é »åº¦**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ 
- **ç›®çš„**: å€‹åˆ¥å•†å“ã®ä¾¡æ ¼ç›£è¦–

#### CLIä¾¡æ ¼æ¯”è¼ƒã‚·ã‚¹ãƒ†ãƒ 
- **åˆ©ç”¨ã‚·ãƒ¼ãƒ³**: å®šæœŸçš„ãªä¾¡æ ¼èª¿æŸ»
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼**: ç®¡ç†è€…ãƒ»ã‚¢ãƒŠãƒªã‚¹ãƒˆ
- **é »åº¦**: 1æ—¥æ•°å›ï¼ˆè‡ªå‹•åŒ–ï¼‰
- **ç›®çš„**: æœ€å®‰å€¤ç™ºè¦‹ãƒ»å¸‚å ´åˆ†æ

---

**2ã¤ã®ã‚·ã‚¹ãƒ†ãƒ ãŒç›¸äº’è£œå®Œçš„ã«å‹•ä½œã—ã€åŒ…æ‹¬çš„ãªä¾¡æ ¼ç›£è¦–ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æä¾›ã—ã¾ã™ã€‚**